# üìä Analytics & Dashboard System Documentation

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Analytics) ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤ Admin Dashboard ‡∏Ç‡∏≠‡∏á AI Robot Guide ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

---

## 1. üèóÔ∏è System Architecture (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö)

### Data Flow Overview
1.  **Interaction:** ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö AI ‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Chat ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Like/Dislike
2.  **API Layer:** `chat_api.py` ‡πÅ‡∏•‡∏∞ `analytics_api.py` ‡∏£‡∏±‡∏ö Request
3.  **Service Layer:** `AnalyticsService` ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
4.  **Database:** ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á MongoDB (`nanaiguide` database)
5.  **Visualization:** `dashboard.js` ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•

### Key Components

| Component | File Path | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å |
| :--- | :--- | :--- |
| **Collector** | `core/services/analytics_service.py` | ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Log ‡∏à‡∏≤‡∏Å Chat ‡πÅ‡∏•‡∏∞ Feedback ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Asynchronous ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ AI ‡∏ï‡∏≠‡∏ö‡∏ä‡πâ‡∏≤ |
| **Aggregator** | `core/database/mongodb_manager.py` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Count, Group By) ‡∏ú‡πà‡∏≤‡∏ô MongoDB Aggregation Pipeline |
| **Frontend** | `frontend/assets/scripts/dashboard.js` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≤‡∏ß (5-Star) ‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ |

---

## 2. üóÉÔ∏è Data Models (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô MongoDB Collection ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:

### 2.1 `analytics_logs` (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤)
‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà AI ‡∏ï‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
```json
{
  "session_id": "uuid...",
  "timestamp": "ISODate(...)",
  "user_query": "‡∏ß‡∏±‡∏î‡∏†‡∏π‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡πå‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÑ‡∏´‡∏ô",
  "ai_response": "‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á...",
  "interest_topic": "Culture",   // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á)
  "location_title": "Wat Phumin", // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏ä‡πâ‡∏ó‡∏≥ Top 10)
  "user_origin": "Thailand",      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°)
  "user_province": "Nan"          // ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
}
```

### 2.2 `feedback_logs` (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à)
‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Like/Dislike
```json
{
  "session_id": "uuid...",
  "timestamp": "ISODate(...)",
  "user_query": "...",
  "feedback_type": "like", // ‡∏´‡∏£‡∏∑‡∏≠ "dislike"
  "reason": null           // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
}
```

---

## 3. ‚≠êÔ∏è Satisfaction Score Calculation (‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)

‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö 5 ‡∏î‡∏≤‡∏ß ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏µ‡πà **Frontend (`dashboard.js`)**:

### Logic
1.  **‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:** `Like` ‡πÅ‡∏•‡∏∞ `Dislike` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡πÄ‡∏ä‡πà‡∏ô 30 ‡∏ß‡∏±‡∏ô)
2.  **‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:** 
    $$ \text{Score} = \left( \frac{\text{Like}}{\text{Like} + \text{Dislike}} \right) \times 5.0 $$
3.  **‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (Labeling):**
    *   **4.5 - 5.0:** üü¢ **‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (Excellent)**
    *   **3.0 - 4.4:** üü° **‡∏î‡∏µ (Good)**
    *   **< 3.0:** üî¥ **‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (Needs Improvement)**

> **Note:** ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Feedback ‡πÄ‡∏•‡∏¢ ‡∏Ñ‡πà‡∏≤ Default ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 5.0

---

## 4. üöÄ Future Development Roadmap (‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î)

‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:

### 4.1 üïµÔ∏è Missed Opportunities Tracking (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)
*   **Concept:** ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà AI ‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ï‡πà‡∏≥ (Low Confidence)
*   **Implementation:** 
    *   ‡πÉ‡∏ô `AnalyticsService`, ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤ `confidence_score` ‡∏à‡∏≤‡∏Å RAG
    *   ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î Tag ‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å Collection `missed_questions`
    *   ‡∏´‡∏ô‡πâ‡∏≤ Dashboard: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Vector DB

### 4.2 üïí Peak Hour Heatmap
*   **Concept:** ‡∏î‡∏π‡∏Å‡∏£‡∏≤‡∏ü‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
*   **Implementation:** ‡πÉ‡∏ä‡πâ `timestamp` ‡πÉ‡∏ô `analytics_logs` ‡∏°‡∏≤ Group ‡∏ï‡∏≤‡∏°‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (Hour 0-23)

### 4.3 üíæ Export Data Feature (User Requested)
*   **Concept:** ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
*   **Format:** CSV (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Excel) ‡∏´‡∏£‡∏∑‡∏≠ PDF
*   **Implementation:** ‡∏™‡∏£‡πâ‡∏≤‡∏á Endpoint `/api/admin/export` ‡∏ó‡∏µ‡πà Backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Generate ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å Query ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

### 4.4 üó∫Ô∏è Conversion Tracking
*   **Concept:** ‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏ß‡πà‡∏≤ AI "‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏´‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏≤‡∏ô‡∏±‡∏Å‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô/‡∏ß‡∏±‡∏î ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
*   **Trigger:** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° **"‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (Google Maps)"** ‡∏´‡∏£‡∏∑‡∏≠ **"‡πÇ‡∏ó‡∏£‡∏≠‡∏≠‡∏Å"**
*   **Implementation:** ‡∏ù‡∏±‡πà‡∏á Frontend (`chat.js`) ‡∏™‡πà‡∏á Event `interaction_type: conversion` ‡∏°‡∏≤‡∏ó‡∏µ‡πà API

---

## 5. üõ†Ô∏è Maintenance & Troubleshooting

*   **Total Conversations = 0 ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ñ‡∏∏‡∏¢?**
    *   ‡πÄ‡∏ä‡πá‡∏Ñ `Back-end/core/services/analytics_service.py`
    *   ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `log_interaction` ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `asyncio.to_thread` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Block Loop)
*   **‡∏Å‡∏£‡∏≤‡∏ü‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô?**
    *   ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `feedback_stats` ‡∏´‡∏£‡∏∑‡∏≠ `location_stats` ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å API ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡πÉ‡∏ä‡πâ `scripts/verify_dashboard_data.py` ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)
